{"version":3,"file":"index.mjs","sources":["../src/emitter.js","../src/utils.js","../src/hooks.js","../src/context.js","../src/createEvent.js","../src/createAction.js","../src/components/EventOpen.js"],"sourcesContent":["import EventEmitter from 'eventemitter3'\n\nconst emitter = new EventEmitter()\n\nemitter.emit = function (...args) {\n  const eventName = String(args[0])\n  const eventId = args[0].uuid\n\n  eventId && duplicateEventDetection(eventName, eventId)\n\n  return this.constructor.prototype.emit.call(this, ...args)\n}\n\nconst emittedEvents = new Map()\n\n\nconst duplicateEventDetection = (name, eventId) => {\n  if (emittedEvents.has(name)) {\n    if (emittedEvents.get(name) !== eventId) {\n      console.warn(\n        `Another event named \"${name}\" already exists. Duplicate events share the same listener. This can lead to unexpected issues if their payload differs. Make sure to call the \\`createEvent\\` function only once per event and reuse the resulting functions throughout your application.`\n      )\n    }\n  }\n\n  emittedEvents.set(name, eventId)\n}\n\nexport default emitter\n","\n\nexport const canUseDom = !!(\n  typeof window !== 'undefined' && window.document?.createElement\n)\n\n","import { useCallback, useRef } from 'react'\nimport { forIn } from 'lodash'\nimport { useIsomorphicLayoutEffect } from 'react-use'\n\nimport defaultEmitter from './emitter'\n\nexport const useEventListeners = (handlers, emitter = defaultEmitter) => {\n  useIsomorphicLayoutEffect(() => {\n    forIn(handlers, (eventHandler, eventName) => {\n      emitter.addListener(eventName, eventHandler)\n    })\n\n    return () => {\n      forIn(handlers, (eventHandler, eventName) => {\n        emitter.removeListener(eventName, eventHandler)\n      })\n    }\n  }, [handlers])\n}\n\nexport const useEventListener = (\n  eventName,\n  eventHandler,\n  emitter = defaultEmitter\n) => {\n  useIsomorphicLayoutEffect(() => {\n    emitter.addListener(eventName, eventHandler)\n\n    return () => {\n      emitter.removeListener(eventName, eventHandler)\n    }\n  }, [eventHandler])\n}\n\nexport const useEvent = handler => {\n  const handlerRef = useRef(() => {\n    throw new Error('Cannot call an event handler during the first render.')\n  })\n\n  useIsomorphicLayoutEffect(() => {\n    handlerRef.current = handler\n  })\n\n  return useCallback((...args) => handlerRef.current?.apply(null, args), [])\n}\n","import { createContext, useContext } from 'react'\nimport defaultEmitter from './emitter'\nimport { useEventListener, useEventListeners } from './hooks'\n\nconst EventEmitterContext = createContext()\n\nexport const EventEmitterProvider = ({ children, emitter: inEmitter }) => {\n  const emitter = inEmitter ?? defaultEmitter\n\n  const value = {\n    emitter,\n    emit: (...args) => emitter.emit(...args),\n    useListener: (eventName, eventHandler) => useEventListener(eventName, eventHandler, emitter),\n    useListeners: eventHandlers => useEventListeners(eventHandlers, emitter)\n  }\n\n  return (\n    <EventEmitterContext.Provider value={value}>\n      {children}\n    </EventEmitterContext.Provider>\n  )\n}\n\nexport const useEventEmitter = () => useContext(EventEmitterContext)\n\nexport default EventEmitterContext","import { useIsomorphicLayoutEffect } from 'react-use'\r\nimport { useEvent } from './hooks'\r\nimport defaultEmitter from './emitter'\r\nimport { canUseDom } from './utils'\r\n\r\nconst createEvent = (name, options = {}) => {\r\n  const emitter = options.emitter ?? defaultEmitter\r\n\r\n  const useListener = handler => {\r\n    const eventHandler = useEvent(handler)\r\n\r\n    useIsomorphicLayoutEffect(() => {\r\n      emitter.addListener(name, eventHandler)\r\n\r\n      return () => {\r\n        emitter.removeListener(name, eventHandler)\r\n      }\r\n    }, [eventHandler])\r\n  }\r\n\r\n  const dispatch = payload => {\r\n    if (!canUseDom) {\r\n      console.warn(\r\n        `Could not emit \"${name}\" event. Events cannot be emitted from the server.`\r\n      )\r\n      return\r\n    }\r\n\r\n    emitter.emit(name, payload)\r\n  }\r\n\r\n  return [dispatch, useListener]\r\n}\r\n\r\nexport default createEvent","import { nanoid } from 'nanoid'\n\nfunction createAction(type, prepareAction) {\n  function actionCreator(...args) {\n    if (prepareAction) {\n      let prepared = prepareAction(...args)\n      if (!prepared) {\n        throw new Error('prepareAction did not return an object')\n      }\n\n      return {\n        type,\n        payload: prepared.payload,\n        ...('meta' in prepared && { meta: prepared.meta }),\n        ...('error' in prepared && { error: prepared.error })\n      }\n    }\n    return { type, payload: args[0] }\n  }\n\n  actionCreator.toString = () => `${type}`\n\n  actionCreator.uuid = nanoid()\n\n  actionCreator.type = type\n\n  actionCreator.match = action => action.type === type\n\n  return actionCreator\n}\n\nexport default createAction\n","function EventBox(){\r\n\r\n}\r\n\r\nexport default EventBox\r\n"],"names":["emitter","EventEmitter","emit","_this$constructor$pro","args","slice","call","arguments","eventName","String","eventId","uuid","duplicateEventDetection","constructor","prototype","apply","this","_window$document","emittedEvents","Map","name","has","get","console","warn","set","handlers","defaultEmitter","useIsomorphicLayoutEffect","forIn","eventHandler","addListener","removeListener","useEventListener","useEvent","handler","useRef","Error","handlerRef","current","useCallback","_handlerRef$current","EventEmitterContext","createContext","EventEmitterProvider","_ref","inEmitter","value","useListener","useListeners","eventHandlers","useEventListeners","_jsx","Provider","children","useEventEmitter","useContext","canUseDom","window","document","createElement","options","payload","createAction","type","prepareAction","actionCreator","prepared","meta","error","toString","nanoid","match","action","EventBox"],"mappings":"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"}
{"version":3,"file":"index.modern.mjs","sources":["../src/emitter.js","../src/hooks.js","../src/context.js","../src/utils.js","../src/createEvent.js","../src/createAction.js","../src/components/EventOpen.js"],"sourcesContent":["import EventEmitter from 'eventemitter3'\n\nconst emitter = new EventEmitter()\n\nemitter.emit = function (...args) {\n  const eventName = String(args[0])\n  const eventId = args[0].uuid\n\n  eventId && duplicateEventDetection(eventName, eventId)\n\n  return this.constructor.prototype.emit.call(this, ...args)\n}\n\nconst emittedEvents = new Map()\n\n\nconst duplicateEventDetection = (name, eventId) => {\n  if (emittedEvents.has(name)) {\n    if (emittedEvents.get(name) !== eventId) {\n      console.warn(\n        `Another event named \"${name}\" already exists. Duplicate events share the same listener. This can lead to unexpected issues if their payload differs. Make sure to call the \\`createEvent\\` function only once per event and reuse the resulting functions throughout your application.`\n      )\n    }\n  }\n\n  emittedEvents.set(name, eventId)\n}\n\nexport default emitter\n","import { useCallback, useRef } from 'react'\nimport { forIn } from 'lodash'\nimport { useIsomorphicLayoutEffect } from 'react-use'\n\nimport defaultEmitter from './emitter'\n\nexport const useEventListeners = (handlers, emitter = defaultEmitter) => {\n  useIsomorphicLayoutEffect(() => {\n    forIn(handlers, (eventHandler, eventName) => {\n      emitter.addListener(eventName, eventHandler)\n    })\n\n    return () => {\n      forIn(handlers, (eventHandler, eventName) => {\n        emitter.removeListener(eventName, eventHandler)\n      })\n    }\n  }, [handlers])\n}\n\nexport const useEventListener = (\n  eventName,\n  eventHandler,\n  emitter = defaultEmitter\n) => {\n  useIsomorphicLayoutEffect(() => {\n    emitter.addListener(eventName, eventHandler)\n\n    return () => {\n      emitter.removeListener(eventName, eventHandler)\n    }\n  }, [eventHandler])\n}\n\nexport const useEvent = handler => {\n  const handlerRef = useRef(() => {\n    throw new Error('Cannot call an event handler during the first render.')\n  })\n\n  useIsomorphicLayoutEffect(() => {\n    handlerRef.current = handler\n  })\n\n  return useCallback((...args) => handlerRef.current?.apply(null, args), [])\n}\n","import { createContext, useContext } from 'react'\nimport defaultEmitter from './emitter'\nimport { useEventListener, useEventListeners } from './hooks'\n\nconst EventEmitterContext = createContext()\n\nexport const EventEmitterProvider = ({ children, emitter: inEmitter }) => {\n  const emitter = inEmitter ?? defaultEmitter\n\n  const value = {\n    emitter,\n    emit: (...args) => emitter.emit(...args),\n    useListener: (eventName, eventHandler) => useEventListener(eventName, eventHandler, emitter),\n    useListeners: eventHandlers => useEventListeners(eventHandlers, emitter)\n  }\n\n  return (\n    <EventEmitterContext.Provider value={value}>\n      {children}\n    </EventEmitterContext.Provider>\n  )\n}\n\nexport const useEventEmitter = () => useContext(EventEmitterContext)\n\nexport default EventEmitterContext","\n\nexport const canUseDom = !!(\n  typeof window !== 'undefined' && window.document?.createElement\n)\n\n","import { useIsomorphicLayoutEffect } from 'react-use'\r\nimport { useEvent } from './hooks'\r\nimport defaultEmitter from './emitter'\r\nimport { canUseDom } from './utils'\r\n\r\nconst createEvent = (name, options = {}) => {\r\n  const emitter = options.emitter ?? defaultEmitter\r\n\r\n  const useListener = handler => {\r\n    const eventHandler = useEvent(handler)\r\n\r\n    useIsomorphicLayoutEffect(() => {\r\n      emitter.addListener(name, eventHandler)\r\n\r\n      return () => {\r\n        emitter.removeListener(name, eventHandler)\r\n      }\r\n    }, [eventHandler])\r\n  }\r\n\r\n  const dispatch = payload => {\r\n    if (!canUseDom) {\r\n      console.warn(\r\n        `Could not emit \"${name}\" event. Events cannot be emitted from the server.`\r\n      )\r\n      return\r\n    }\r\n\r\n    emitter.emit(name, payload)\r\n  }\r\n\r\n  return [dispatch, useListener]\r\n}\r\n\r\nexport default createEvent","import { nanoid } from 'nanoid'\n\nfunction createAction(type, prepareAction) {\n  function actionCreator(...args) {\n    if (prepareAction) {\n      let prepared = prepareAction(...args)\n      if (!prepared) {\n        throw new Error('prepareAction did not return an object')\n      }\n\n      return {\n        type,\n        payload: prepared.payload,\n        ...('meta' in prepared && { meta: prepared.meta }),\n        ...('error' in prepared && { error: prepared.error })\n      }\n    }\n    return { type, payload: args[0] }\n  }\n\n  actionCreator.toString = () => `${type}`\n\n  actionCreator.uuid = nanoid()\n\n  actionCreator.type = type\n\n  actionCreator.match = action => action.type === type\n\n  return actionCreator\n}\n\nexport default createAction\n","function EventBox(){\r\n\r\n}\r\n\r\nexport default EventBox\r\n"],"names":["emitter","EventEmitter","emit","args","eventName","String","eventId","uuid","duplicateEventDetection","constructor","prototype","call","this","emittedEvents","Map","name","has","get","console","warn","set","defaultEmitter","useEventListeners","handlers","useIsomorphicLayoutEffect","forIn","eventHandler","addListener","removeListener","useEventListener","handler","handlerRef","useRef","Error","current","useCallback","_handlerRef$current","apply","EventEmitterContext","createContext","EventEmitterProvider","children","inEmitter","_jsx","Provider","value","useListener","useListeners","eventHandlers","useEventEmitter","useContext","_window$document","EventEmitterContext$1","canUseDom","window","document","createElement","createEvent$1","options","_options$emitter","payload","useEvent","createAction","type","prepareAction","actionCreator","prepared","meta","error","toString","nanoid","match","action","EventBox"],"mappings":"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"}